name: Deploy Docs

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup environment
      run: |
        # Создаем базовую структуру
        mkdir -p docs/doxygen/html
        
        # Создаем минимальный Doxyfile
        cat > Doxyfile << 'EOF'
        PROJECT_NAME = WarehouseSystem
        OUTPUT_DIRECTORY = docs/doxygen
        INPUT = src
        FILE_PATTERNS = *.cs
        RECURSIVE = YES
        EXTRACT_ALL = YES
        GENERATE_HTML = YES
        EOF
        
        # Устанавливаем doxygen
        sudo apt-get update
        sudo apt-get install -y doxygen graphviz
        
        # Генерируем документацию
        doxygen Doxyfile || echo "Doxygen warning"
        
        # Если документация не создалась, создаем заглушку
        if [ ! -f "docs/doxygen/html/index.html" ]; then
          echo "<h1>WarehouseSystem</h1><p>Documentation will be available soon</p>" > docs/doxygen/html/index.html
        fi
    
    - name: Deploy
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: docs/doxygen/html
